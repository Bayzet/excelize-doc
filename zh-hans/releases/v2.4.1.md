# Excelize v2.4.1

* 发布日期: 2021年8月2日
* GitHub Release: [https://github.com/xuri/excelize/releases/tag/v2.4.1](https://github.com/xuri/excelize/releases/tag/v2.4.1)

## Release Notes

此版本中最显著的变化包括：

### 新增功能

* 新增流式设置工作表列宽度支持，相关 issue [#625](https://github.com/xuri/excelize/issues/625)
* 新增流式创建合并单元格支持，相关 issue [#826](https://github.com/xuri/excelize/issues/826)
* 公式计算引擎新增 2 项公式函数支持: BESSELK, BESSELY
* 公式计算引擎支持自定义名称引用，相关 issue [#856](https://github.com/xuri/excelize/issues/856)
* 添加图表时支持设置不显示主要横纵坐标轴
* 通过 [`AddPivotTable`](https://pkg.go.dev/github.com/360EntSecGroup-Skylar/excelize/v2@v2.4.1#File.AddPivotTable) 创建数据透视表支持通过自定义名称动态引用数据源
* 以下函数新增支持并发安全调用，相关 issue [#861](https://github.com/xuri/excelize/issues/829)
  * [`AddPicture`](https://pkg.go.dev/github.com/360EntSecGroup-Skylar/excelize/v2@v2.4.1#File.AddPicture) 和 [`GetPicture`](https://pkg.go.dev/github.com/360EntSecGroup-Skylar/excelize/v2@v2.4.1#File.GetPicture) 并发插入/获取图片
  * [`Rows`](https://pkg.go.dev/github.com/360EntSecGroup-Skylar/excelize/v2@v2.4.1#File.Rows) 和 [`Cols`](https://pkg.go.dev/github.com/360EntSecGroup-Skylar/excelize/v2@v2.4.1#File.Cols) 并发行/列迭代
  * [`SetSheetRow`](https://pkg.go.dev/github.com/360EntSecGroup-Skylar/excelize/v2@v2.4.1#File.SetSheetRow) 并发按行赋值
  * [`SetCellStyle`](https://pkg.go.dev/github.com/360EntSecGroup-Skylar/excelize/v2@v2.4.1#File.SetCellStyle) 并发设置单元格样式
  * [`NewStyle`](https://pkg.go.dev/github.com/360EntSecGroup-Skylar/excelize/v2@v2.4.1#File.NewStyle) 并发创建样式
* 导出 24 个内部异常消息

### 兼容性提升

* 提升内部默认 XML 命名空间兼容性，修复部分情况下生成文档损坏的问题
* 兼容带有非标准页面布局属性数据类型的电子表格文档，避免打开失败的问题
* 增加内部共享字符表计数
* 解除通过给定的时间设置单元格的值时，需要协调世界时 (UTC) 的限制，相关 issue [#409](https://github.com/xuri/excelize/issues/409)
* 增加对内部 XML 控制字符的兼容
* 重命名导出字段 `File.XLSX` 为 `File.Pkg`
* 修改 `NewSheet`, `GetSheetIndex`, `DeleteSheet` 对工作表名称大小写不敏感，相关 issue [#873](https://github.com/xuri/excelize/issues/873)

### 问题修复

* 修复部分情况下 12/24 制小时时间格式解析异常的问题，解决 issue [#823](https://github.com/xuri/excelize/issues/823) 和 issue [#841](https://github.com/xuri/excelize/issues/841)
* 修复部分情况下无法通过 [`GetComments`](https://pkg.go.dev/github.com/360EntSecGroup-Skylar/excelize/v2@v2.4.1#File.GetComments) 获取批注的问题，解决 issue [#825](https://github.com/xuri/excelize/issues/825)
* 修复设置和获取批注时支持多个批注作者，解决 issue [#829](https://github.com/xuri/excelize/issues/829) 和 [#830](https://github.com/xuri/excelize/issues/830)
* 修复命名空间地址解析异常而产生重复命名空间，导致删除再创建同名工作表后的生成文档损坏问题，解决 issue [#834](https://github.com/xuri/excelize/issues/834)
* 修复当设置工作表分组默认属性 `showOutlineSymbols`、`summaryBelow` 和 `summaryRight` 为 `false` 时，设置失效的问题
* 修复部分情况下 [`GetRows`](https://pkg.go.dev/github.com/360EntSecGroup-Skylar/excelize/v2@v2.4.1#File.GetRows) 返回冗余工作表尾部空行的问题，解决 issue [#842](https://github.com/xuri/excelize/issues/842)
* 修复部分情况下获取获取单元格的值时，未返回带有公式的空单元格的问题，解决 issue [#855](https://github.com/xuri/excelize/issues/855)
* 修复部分情况下 IF 公式条件运算错误问题，解决 issue [#858](https://github.com/xuri/excelize/issues/858)
* 修复通过 [`GetRowHeight`](https://pkg.go.dev/github.com/360EntSecGroup-Skylar/excelize/v2@v2.4.1#File.GetRowHeight) 获取行高度错误的问题
* 修复部分情况下因范围解析异常导致获取自定义名称错误的问题
* 修复设置自定义名称时关联工作表索引错误的问题
* 修复设置列样式时已有单元格样式未被更新的问题
* 修复使用非法数据引用范围创建数据透视表时导致的潜在 panic 的问题

### 性能优化

* 通过 [`Save`](https://pkg.go.dev/github.com/360EntSecGroup-Skylar/excelize/v2@v2.4.1#File.Save) 保存或 [`SaveAs`](https://pkg.go.dev/github.com/360EntSecGroup-Skylar/excelize/v2@v2.4.1#File.SaveAs) 另存文档时的内占用降低约 19%

### 其他

* Go Modules 依赖模块更新
* 单元测试与文档更新
* 持续集成服务改用 GitHub Action
* 包含简体中文、英语、法语、俄语、日语、韩语、阿拉伯语、德语和西班牙语的[多国语言文档网站](https://xuri.me/excelize)更新
